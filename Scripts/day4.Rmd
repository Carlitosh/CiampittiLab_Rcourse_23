
# Packages
```{r message=FALSE, warning=FALSE}
library(tidyverse)
```



# 1) Example 1: Linear Regression
# 1.1) Data
```{r}
wheat <- read.csv("../Data/wheat_yield.csv")
```

# 1.2) Quick view
- Numerically
```{r}
glimpse(wheat)
summary(wheat)
```

- Graphically
```{r}
names(wheat)
wheat %>% 
  ggplot() +
  geom_point(aes(N_rate, yield_kg.ha)) +
  scale_x_continuous(limits = c(40,100),
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0,3200),
                     expand = c(0,0))
```

# 1.3) Linear model
# 1.3.1) Fit the model
- lm() function
```{r}
names(wheat)
wheat_yield <- lm(yield_kg.ha ~ N_rate, data = wheat)

wheat_yield#$

```

- Test hypothesis
```{r}
summary(wheat_yield)
```


# 1.3.2) Checking assumptions
- Getting predicted values
```{r}
# Add predicted values into the data frame
# - Tidyverse option
wheat <- wheat %>% 
  mutate(pred.lm = fitted(wheat_yield))

# - R base options
wheat$pred.lm <- wheat_yield$fitted.values
# wheat$pred.lm <- fitted(wheat_yield)
```

- Getting the residuals
```{r}
# - Optiont 1 -> residuals = observed - predicted
wheat$netp_g.m2.y - wheat$pred.lm

# - Option 2 -> use residuals() function or the object created for the model
wheat$res.lm <- residuals(wheat_yield)
wheat$res.lm <- wheat_yield$residuals
```

# 1.3.2.1) Normality of the residuals
Q-Q plot
```{r}
wheat %>% 
  ggplot() +
  stat_qq(aes(sample = res.lm)) +
  stat_qq_line(aes(sample = res.lm))

```

# 1.3.2.2) Homocedasticity (homogeinity of variance)
- Residuals vs Fitted
```{r}
wheat %>% 
  ggplot() +
  geom_point(aes(pred.lm, res.lm)) +
  geom_hline(yintercept = 0) +
  labs(y = expression(Residuals), 
       x = expression(Fitted))
```



```{r}
wheat %>% 
  ggplot() +
  geom_point(aes(N_rate, yield_kg.ha)) +
  scale_x_continuous(limits = c(40,100)) +
  scale_y_continuous(limits = c(0,3200))
```






# 2) Example 1: Linear Regression
# 2.1) Data
```{r}
water <- read.csv("../Data/water_pasture.csv")
```

# 2.2) Quick view
- Numerically
```{r}
glimpse(water)
summary(water)
```

- Graphically
```{r}
water %>% 
  ggplot() +
  geom_point(aes(pp_anual_mm, netp_g.m2.y)) +
  scale_x_continuous(limits = c(0,1200),
                     expand = c(0,0)) +
  scale_y_continuous(limits = c(0,1000), 
                     expand = c(0,0)) +
  coord_cartesian(xlim = c(0,1300))
```


# 2.3) Linear model
# 2.3.1) Fit the model
- lm() function
```{r}
names(water)
past_prod <- lm(netp_g.m2.y ~ pp_anual_mm, data = water)

past_prod#$

```

- Test hypothesis
```{r}
summary(past_prod)
```


# 2.3.2) Checking assumptions
- Getting predicted values
```{r}
# Add predicted values into the data frame
# - Tidyverse option
water <- water %>% 
  mutate(pred.lm = fitted(past_prod))

# - R base options
water$pred.lm <- past_prod$fitted.values
# water$pred.lm <- fitted(past_prod)
```

- Getting the residuals
```{r}
# - Optiont 1 -> residuals = observed - predicted
water$netp_g.m2.y - water$pred.lm

# - Option 2 -> use residuals() function or the object created for the model
water$res.lm <- residuals(past_prod)
water$res.lm <- past_prod$residuals
```

# 2.3.2.1) Normality of the residuals
Q-Q plot
```{r}
water %>% 
  ggplot() +
  stat_qq(aes(sample = res.lm)) +
  stat_qq_line(aes(sample = res.lm))

```

# 2.3.2.2) Homocedasticity (homogeinity of variance)
- Residuals vs Fitted
```{r}
water %>% 
  ggplot() +
  geom_point(aes(pred.lm, res.lm)) +
  geom_hline(yintercept = 0) +
  labs(y = expression(Residuals), 
       x = expression(Fitted))
```





